WITH CustomerRunningTotal AS (
    SELECT
        customer_id,
        order_date,
        order_amount,
        SUM(order_amount) OVER (PARTITION BY customer_id ORDER BY order_date) AS running_total
    FROM
        orders
    WHERE
        EXTRACT(YEAR FROM order_date) = 2023
)
SELECT
    customer_id,
    order_date,
    running_total,
    MIN(CASE WHEN running_total >= 1000 THEN order_date END) OVER (PARTITION BY customer_id) AS date_reached_1000
FROM
    CustomerRunningTotal
ORDER BY
    customer_id, order_date;
